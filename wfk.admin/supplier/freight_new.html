<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
    <title>添加运费模板</title>	
	<link rel="stylesheet" type="text/css" href="../resources/libs/bootstrap/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../resources/css/manage/reset.css"/>
    <link rel="stylesheet" type="text/css" href="../resources/css/manage/main.css"/>
    <link rel="stylesheet" type="text/css" href="../resources/css/manage/skin/layer.css" />
    <link rel="stylesheet" type="text/css" href="../resources/css/manage/skin/layer.ext.css" />
    <script type="text/javascript" src="../resources/libs/jquery/jquery-1.11.3.min.js"></script>
	<script type="text/javascript" src="../resources/libs/plug/crypto.js"></script>
	<script type="text/javascript" src="../resources/libs/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="../resources/libs/jquery/jquery.form.js"></script>
	<script type="text/javascript" src="../resources/libs/plug/checkfile.js"></script>
	<script type="text/javascript" src="../resources/libs/validate/jquery.validate.js"></script>
	<script type="text/javascript" src="../resources/libs/validate/messages_cn.js"></script>
	<script type="text/javascript" src="../resources/libs/validate/validate_methods.js"></script>
	<script type="text/javascript" src="../resources/js/common/common_.js"></script>
	<script type="text/javascript" src="../resources/js/common/base.js"></script>
    <script type="text/javascript" src="../resources/js/common/layer.js"></script>
	<script type="text/javascript">
		var io = 1;
	</script>
	<script type="text/javascript" src="../resources/js/supplier/product/areaTemp_new.js"></script>
    <script>
        $(document).ready(function () {
        	$("input[name='supId']").val($("#supId",parent.parent.document).val());
        	$(document).on("click","#messagediv",function(){
        		var select = $(this).attr("data");
        		var ft = ftval("0")
        		
                layer.open({
                    type: 2,
                    title: '选择区域',
                    fix: false,
                    shadeClose: true,
                    area: ['800px', '350px'],
                    content: 'freight_box.html?data='+select+'&val='+ft,
                    btn: ['确定','取消'],
					yes: function(index, layero){
						var body = layer.getChildFrame('body', index);
                        var iframeWin = window[layero.find('iframe')[0]['name']]; //得到iframe页的窗口对象，执行iframe页的方法：iframeWin.method();
                        var html =  iframeWin.list();
                        $("#Temptd").after(listinfo(html));
						layer.close(index);
                    },
                    cancel: function(index){
                    	layer.close(index);
                    },
                });
            	
        	})
        	//省市区ID
        	function li(v){
        		var d =v.split("&")
        		var htl = '';
        		$.each(d,function(i,j){
					var vl= j.split(":");
					htl+=vl[0].split("|")[0]+":"+splitshi(vl[1],0)+";";
        		})
        		htl = htl.substring(0,htl.length-1);
        		return htl;
        	}
        	//获取选中的值
        	function ftval ( at ){
        		var html ='';
        		$("input[name='areaList']").each(function(){
        			var ips = $(this).attr("d"); 
        			if(at!=""){
        				if("dval"+at!=ips){
        					var hj = $(this).val();
        					 
        					var d =hj.split("&")
        	        		$.each(d,function(i,j){
        						var vl= j.split(":");
        						html+=vl[0].split("|")[0]+",";
        	        		})
        				}
        			}
        		})
        		html = html.substring(0,html.length-1);
        		return html;
        	}
        	//编辑
        	$(document).on("click",".system-freight-edit",function(){
        		var price=$("[name=price]").val();
        		var $this=$(this);
        		var select = $(this).attr("data");
        		var val = $this.attr("val");
        		var ft = ftval($(this).attr("val"))//筛选已经选上的值
        		layer.open({
                     type: 2,
                     title: '选择区域',
                     fix: false,
                     shadeClose: true,
                     area: ['800px', '350px'],
                     content: 'freight_box.html?data='+select+'&val='+ft+"&ds="+val,//+escape(sd),
                     btn: ['确定','取消'],
 					 yes: function(index, layero){
 						var body = layer.getChildFrame('body', index);
                        var iframeWin = window[layero.find('iframe')[0]['name']]; //得到iframe页的窗口对象，执行iframe页的方法：iframeWin.method();
                        var html =  iframeWin.list();
                        $("tr[datatr='"+val+"']").empty();
                        $("#Temptd").after(listinfo(html));
                        $("[name=price]").val(price);
 						layer.close(index);
                     },cancel: function(index){
                     	 
                     },
                 });
        		
        	})
            function listinfo(data){
        		var htmls = '';
            	if(JSON.stringify(data)!='{}'){
            		var htmls = ' ';
            		var vals = '';
						htmls += '<tr datatr="'+io+'">';
						htmls += '<td>';
						htmls += '<div class="textalign">';
						htmls += '<ul >';
						$.each(data,function(i,j){
							 var pro= i.split("|");
							 if(pro[2]=="1"){
								 htmls += '<li>'; 
								 htmls += pro[1];
							 }else if(pro[2]=="2"){
								htmls += '<li>';
								htmls += pro[1]+":　";
								$.each(j.split(","),function(ii,jj){
									if(jj.split("|")[0]!="parentId"){
									htmls+=jj.split("|")[1]+" ,";
									}
								})
							}
								htmls= htmls.substring(0,htmls.length-1);
								htmls += '</li>';
								vals+=i+":"+j+"&";
						})
							htmls +='<input type="hidden" d="dval'+io+'" name="areaList" value="'+vals.substring(0,vals.length-1)+'" >';
							htmls += '</ul></div>';
							htmls += '<a href="javascript:;" val="'+io+'" class="system-freight-edit" datas="" data="">编辑</a>';
							io+=1;
							htmls += '</td>';
							htmls += '<td>';
								htmls += '<input type="text" required="true" number="true" digits="true" aria-required="true" placeholder="运费"  class="system-freight-input" name="price"/>';;
								htmls += '<i  class="system-form-hint error" for="price" style="display: none;">输入有错</i>';
							htmls += '</td>';
							htmls += '<td>';
								htmls += '<div class="system-table-list">';
									htmls += '<ul>';
										htmls += '<li><a href="javascript:;" class="operate-icon4" id="deleteAreaLsit" title="删除"></a></li>';
									htmls += '</ul>';
								htmls += '</div>';
							htmls += '</td>';
						htmls += '</tr>';
            	}
            return htmls ; //$("#Temptd").after(htmls);
            }
        })
    </script>
    <style type="text/css">
    	.textalign{
    		width:90%;
    		text-align: left;
    		display:inline-block;
    	}
    	.error{
    		color: red;
    		font-size: 12px;
    	}
    </style>
</head>
<body>
	<div class="system-substance">
	    <h1>添加运费模板</h1>
	    <form action="" id="tempAction" >
	    <input type="hidden" name="supId">
	    <input type="hidden" id="oldtName">
	    <input type="hidden" id="check_name_msg">
	    <div class="system-freight">
	        <div class="system-freight-box clearfix">
	            <span>模板名称：</span><input type="text" maxlength="45" id="check_name"  stringCheck="true" required="" aria-required="true" placeholder="模板名称" class="system-form-box left" name="tName">
				<label id="show_msg" class="system-form-hint error" for="tName" style="display: none;">模板名称不能为空</label>	            
	        </div>
	        <div class="system-freight-box clearfix">
	            <span>配送区域：</span>
	            
	            <table class="system-table">
	                <tr id="Temptd">
	                    <td width="40%">配送区域</td>
	                    <td width="40%">邮费</td>
	                    <td>操作</td>
	                </tr>
	                <tr>
	                    <td colspan="3" class="tl"><a href="javascript:;" id="messagediv">为指定区域设置运费</a></td>
	                </tr>
	            </table>
	        </div>
	    </div>
	    <input type="hidden" name="tid" value="" />
	    </form>
	    <div class="system-order-btn">
	        <button type="button" id="close">返回</button>
	        <button type="button" id="OK" class="system-btn-c">确定</button>
	    </div>
	</div>
</body>
</html>